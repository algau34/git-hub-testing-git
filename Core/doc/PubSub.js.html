<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>PubSub.js - Documentation</title>
	<meta property="og:title" content=""/>
	<meta property="og:type" content="website"/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<script src="scripts/prettify/prettify.js"></script>
	<script src="scripts/prettify/lang-css.js"></script>
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/prettify.css">
	<link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
	<script src="scripts/nav.js" defer></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body><input type="checkbox" id="nav-trigger" class="nav-trigger"/><label for="nav-trigger" class="navicon-button x">
	<div class="navicon"></div>
</label><label for="nav-trigger" class="overlay"></label>
<nav class="wrap"><input type="text" id="nav-search" placeholder="Search"/>
	<h2><a href="index.html">Home</a></h2>
	<h3>Classes</h3>
	<ul>
		<li><a href="ArrayExtd.html">ArrayExtd</a>
			<ul class='methods'>
				<li data-type='method' title='get of ArrayExtd' style='display: none;'><a
						href="ArrayExtd.html#get">get</a></li>
			</ul>
		</li>
		<li><a href="Cr.html">Cr</a>
			<ul class='members'>
				<li data-type='member' style='display: none;'><a href="Cr.html#.targetUrl">targetUrl</a></li>
			</ul>
			<ul class='methods'>
				<li data-type='method' title='getFile of Cr' style='display: none;'><a
						href="Cr.html#.getFile">getFile</a></li>
				<li data-type='method' title='importScript of Cr' style='display: none;'><a
						href="Cr.html#.importScript">importScript</a></li>
			</ul>
		</li>
		<li><a href="CSSStyleSheetExtd.html">CSSStyleSheetExtd</a>
			<ul class='methods'>
				<li data-type='method' title='addCSSRuleInJson of CSSStyleSheetExtd' style='display: none;'><a
						href="CSSStyleSheetExtd.html#addCSSRuleInJson">addCSSRuleInJson</a></li>
			</ul>
		</li>
		<li><a href="documentExtd.html">documentExtd</a>
			<ul class='methods'>
				<li data-type='method' title='createStyleSheet of documentExtd' style='display: none;'><a
						href="documentExtd.html#.createStyleSheet">createStyleSheet</a></li>
				<li data-type='method' title='transformXHTMLToDom of documentExtd' style='display: none;'><a
						href="documentExtd.html#.transformXHTMLToDom">transformXHTMLToDom</a></li>
			</ul>
		</li>
		<li><a href="HTMLElementExtd.html">HTMLElementExtd</a>
			<ul class='members'>
				<li data-type='member' style='display: none;'><a href="HTMLElementExtd.html#.innerXHTML">innerXHTML</a>
				</li>
			</ul>
			<ul class='methods'>
				<li data-type='method' title='appendChildNodes of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#appendChildNodes">appendChildNodes</a></li>
				<li data-type='method' title='getCalculatedCss of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#getCalculatedCss">getCalculatedCss</a></li>
				<li data-type='method' title='getCss of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#getCss">getCss</a></li>
				<li data-type='method' title='getJs of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#getJs">getJs</a></li>
				<li data-type='method' title='getParentByCssSelector of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#getParentByCssSelector">getParentByCssSelector</a></li>
				<li data-type='method' title='moveStyleSheet of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#moveStyleSheet">moveStyleSheet</a></li>
				<li data-type='method' title='nextSiblingByCssSelector of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#nextSiblingByCssSelector">nextSiblingByCssSelector</a></li>
				<li data-type='method' title='nextSiblingByTagName of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#nextSiblingByTagName">nextSiblingByTagName</a></li>
				<li data-type='method' title='previousSiblingByCssSelector of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#previousSiblingByCssSelector">previousSiblingByCssSelector</a></li>
				<li data-type='method' title='previousSiblingByTagName of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#previousSiblingByTagName">previousSiblingByTagName</a></li>
				<li data-type='method' title='removeComments of HTMLElementExtd' style='display: none;'><a
						href="HTMLElementExtd.html#removeComments">removeComments</a></li>
			</ul>
		</li>
		<li><a href="JSONExtd.html">JSONExtd</a>
			<ul class='methods'>
				<li data-type='method' title='transformToCss of JSONExtd' style='display: none;'><a
						href="JSONExtd.html#.transformToCss">transformToCss</a></li>
			</ul>
		</li>
		<li><a href="ObjectExtd.html">ObjectExtd</a></li>
		<li><a href="PubSub.html">PubSub</a>
			<ul class='members'>
				<li data-type='member' style='display: none;'><a href="PubSub.html#.ALL_SUBSCRIBING_MSG">ALL_SUBSCRIBING_MSG</a>
				</li>
				<li data-type='member' style='display: none;'><a href="PubSub.html#.getInstance">getInstance</a></li>
				<li data-type='member' style='display: none;'><a href="PubSub.html#.immediateExceptions">immediateExceptions</a>
				</li>
				<li data-type='member' style='display: none;'><a href="PubSub.html#.instance">instance</a></li>
				<li data-type='member' style='display: none;'><a href="PubSub.html#.lastUid">lastUid</a></li>
				<li data-type='member' style='display: none;'><a href="PubSub.html#.messages">messages</a></li>
			</ul>
			<ul class='methods'>
				<li data-type='method' title='clearAllSubscriptions of PubSub' style='display: none;'><a
						href="PubSub.html#.clearAllSubscriptions">clearAllSubscriptions</a></li>
				<li data-type='method' title='clearSubscriptions of PubSub' style='display: none;'><a
						href="PubSub.html#.clearSubscriptions">clearSubscriptions</a></li>
				<li data-type='method' title='countSubscriptions of PubSub' style='display: none;'><a
						href="PubSub.html#.countSubscriptions">countSubscriptions</a></li>
				<li data-type='method' title='getSubscriptions of PubSub' style='display: none;'><a
						href="PubSub.html#.getSubscriptions">getSubscriptions</a></li>
				<li data-type='method' title='publish of PubSub' style='display: none;'><a href="PubSub.html#.publish">publish</a>
				</li>
				<li data-type='method' title='publishSync of PubSub' style='display: none;'><a
						href="PubSub.html#.publishSync">publishSync</a></li>
				<li data-type='method' title='subscribe of PubSub' style='display: none;'><a
						href="PubSub.html#.subscribe">subscribe</a></li>
				<li data-type='method' title='subscribeAll of PubSub' style='display: none;'><a
						href="PubSub.html#.subscribeAll">subscribeAll</a></li>
				<li data-type='method' title='subscribeOnce of PubSub' style='display: none;'><a
						href="PubSub.html#.subscribeOnce">subscribeOnce</a></li>
				<li data-type='method' title='unsubscribe of PubSub' style='display: none;'><a
						href="PubSub.html#.unsubscribe">unsubscribe</a></li>
			</ul>
		</li>
		<li><a href="StringExtd.html">StringExtd</a>
			<ul class='methods'>
				<li data-type='method' title='performOnStrHTMLBySelector of StringExtd' style='display: none;'><a
						href="StringExtd.html#performOnStrHTMLBySelector">performOnStrHTMLBySelector</a></li>
				<li data-type='method' title='shuffle of StringExtd' style='display: none;'><a
						href="StringExtd.html#shuffle">shuffle</a></li>
			</ul>
		</li>
	</ul>
</nav>
<div id="main"><h1 class="page-title">PubSub.js</h1>
	<section>
		<article><pre class="prettyprint source linenums"><code>/**
 * Created by jetbrains web development IDE ( Web/PhpStorm ).
 * Project: define-newElementHTML - myProject
 * User: algau34
 * Mail: al.gau@free.fr
 * Date: 09/07/2021
 * Time: 14:59
 */

/**
 * class PubSub
 * @classdesc publish subscribe
 */
class PubSub {

	/**
	 * @memberOf PubSub
	 * @type {{}}
	 */
	static messages = {};

	/**
	 * @memberOf PubSub
	 * @type {number}
	 */
	static lastUid = -1;

	/**
	 * @memberOf PubSub
	 * @type {string}
	 */
	static ALL_SUBSCRIBING_MSG = '*';

	/**
	 * @memberOf PubSub
	 * @type {boolean}
	 */
	static immediateExceptions = true;
	/**
	 * @memberOf PubSub
	 */
	static  instance;

	/**
	 *
	 * @param lastUid
	 * @param ALL_SUBSCRIBING_MSG
	 * @param immediateExceptions
	 */
	constructor( lastUid= -1, ALL_SUBSCRIBING_MSG= '*', immediateExceptions= true) {

		PubSub.ALL_SUBSCRIBING_MSG=ALL_SUBSCRIBING_MSG;
		PubSub.lastUid=lastUid;
	    PubSub.immediateExceptions=immediateExceptions ;
	}

	/**
	 * singleton
	 * @returns {*}
	 */
	static get getInstance(){
		if (PubSub.instance == null) {
			PubSub.instance = new PubSub ();
			// Hide the constructor so the returned object can't be new'd...
			PubSub.instance.constructor = null;
		}
		return PubSub.instance;
	}

	/**
	 *  Publishes the message synchronously, passing the data to it's subscribers
	 * @param message
	 * @param data
	 * @returns {*|Boolean}
	 */
 static publishSync  ( message, data ){
		return PubSub.publish( message, data, true,   PubSub.immediateExceptions );
	};

	/**
	 * Subscribes the passed function to the passed message. Every returned token is unique and should be stored if you need to unsubscribe
	 * @param message
	 * @param func
	 * @returns {string|boolean}
	 */
 static subscribe  ( message, func ){
		if ( typeof func !== 'function'){
			return false;
		}

		message = (typeof message === 'symbol') ? message.toString() : message;

		// message is not registered yet
		if ( !Object.prototype.hasOwnProperty.call( PubSub.messages, message ) ){
			PubSub.messages[message] = {};
		}

		// forcing token as String, to allow for future expansions without breaking usage
		// and allow for easy use as key names for the 'messages' object
		var token = 'uid_' + String(++PubSub.lastUid);
		PubSub.messages[message][token] = func;

		// return token for unsubscribing
		return token;
	};

	/**
	 *
	 * @param func
	 * @returns {string|boolean}
	 */
 static subscribeAll  ( func ){
		return PubSub.subscribe(PubSub.ALL_SUBSCRIBING_MSG, func);
	};

	/**
	 *  Subscribes the passed function to the passed message once
	 * @param message
	 * @param func
	 * @returns {PubSub}
	 */
 static subscribeOnce  ( message, func ){
		var token = PubSub.subscribe( message, function(){
			// before func apply, unsubscribe message
			PubSub.unsubscribe( token );
			func.apply( this, arguments );
		});
		return PubSub;
	};

	/**
	 * Clears all subscriptions
	 */
 static clearAllSubscriptions  (){
		PubSub.messages = {};
	};

	/**
	 *  Clear subscriptions by the topic
	 * @param topic
	 */
 static clearSubscriptions  (topic){
		var m;
		for (m in PubSub.messages){
			if (Object.prototype.hasOwnProperty.call(PubSub.messages, m) &amp;&amp; m.indexOf(topic) === 0){
				delete PubSub.messages[m];
			}
		}
	};

	/**
	 * Count subscriptions by the topic
	 * @param topic
	 * @returns {number}
	 */
 static countSubscriptions  (topic){
		var m;
		// eslint-disable-next-line no-unused-vars
		var token;
		var count = 0;
		for (m in  PubSub.messages) {
			if (Object.prototype.hasOwnProperty.call( PubSub.messages, m) &amp;&amp; m.indexOf(topic) === 0) {
				for (token in  PubSub.messages[m]) {
					count++;
				}
				break;
			}
		}
		return count;
	};


	/**
	 * Gets subscriptions by the topic
	 * @param topic
	 * @returns {string[]}
	 */
 static getSubscriptions  (topic){
		return Object.keys(PubSub.messages);
	};

	/**
	 * Removes subscriptions
	 *
	 * - When passed a token, removes a specific subscription.
	 *
	 * - When passed a function, removes all subscriptions for that function
	 *
	 * - When passed a topic, removes all subscriptions for that topic (hierarchy)
	 * @example // Unsubscribing with a token
	 * PubSub.unsubscribe(token);
	 * var token = PubSub.subscribe('mytopic', myFunc);
	 * @example // Unsubscribing with a function
	 * PubSub.unsubscribe(myFunc);
	 * @example // Unsubscribing from a topic
	 * PubSub.unsubscribe('mytopic');
	 *
	 * @param value
	 * @returns {boolean} A token, function or topic to unsubscribe from
	 */
 static unsubscribe  (value){
		var descendantTopicExists = (topic)=> {
				var m;
				for ( m in PubSub.messages ){
					if ( Object.prototype.hasOwnProperty.call(PubSub.messages, m) &amp;&amp; m.indexOf(topic) === 0 ){
						// a descendant of the topic exists:
						return true;
					}
				}
				return false;
			},
			isTopic    = typeof value === 'string' &amp;&amp; ( Object.prototype.hasOwnProperty.call(PubSub.messages, value) ||
														descendantTopicExists(value) ),
			isToken    = !isTopic &amp;&amp; typeof value === 'string',
			isFunction = typeof value === 'function',
			result = false,
			m, message, t;

		if (isTopic){
			PubSub.clearSubscriptions(value);
			return;
		}

		for ( m in PubSub.messages ){
			if ( Object.prototype.hasOwnProperty.call( PubSub.messages, m ) ){
				message = PubSub.messages[m];

				if ( isToken &amp;&amp; message[value] ){
					delete message[value];
					result = value;
					// tokens are unique, so we can just stop here
					break;
				}

				if (isFunction) {
					for ( t in message ){
						if (Object.prototype.hasOwnProperty.call(message, t) &amp;&amp; message[t] === value){
							delete message[t];
							result = true;
						}
					}
				}
			}
		}

		return result;
	};

	/**
	 * test if pubSub has one key
	 * @param obj
	 * @returns {boolean}
	 * @private
	 */
	_hasKeys(obj){
		var key;

		for (key in obj){
			if ( Object.prototype.hasOwnProperty.call(obj, key) ){
				return true;
			}
		}
		return false;
	}

	/**
	 *  Returns a _that throws the passed exception, for use as argument for setTimeout
	 * @param { Object } ex An Error object
	 * @private
	 */
	_throwException( ex ){
	 throw ex.toString();
	}

	/**
	 *
	 * @param subscriber
	 * @param message
	 * @param data
	 * @private
	 */
	_callSubscriberWithDelayedExceptions( subscriber, message, data ){
		try {
			subscriber( message, data );
		} catch( ex ){
			setTimeout( this._throwException( ex ), 0);
		}
	}

	/**
	 *
	 * @param subscriber
	 * @param message
	 * @param data
	 * @private
	 */
	_callSubscriberWithImmediateExceptions( subscriber, message, data ){
		subscriber( message, data );
	}

	/**
	 *
	 * @param originalMessage
	 * @param matchedMessage
	 * @param data
	 * @param immediateExceptions
	 * @private
	 */
	_deliverMessage( originalMessage, matchedMessage, data, immediateExceptions ){
		var subscribers = PubSub.messages[matchedMessage],
			callSubscriber = immediateExceptions ? this._callSubscriberWithImmediateExceptions : this._callSubscriberWithDelayedExceptions,
			s;

		if ( !Object.prototype.hasOwnProperty.call( PubSub.messages, matchedMessage ) ) {
			return;
		}

		for (s in subscribers){
			if ( Object.prototype.hasOwnProperty.call(subscribers, s)){
				callSubscriber( subscribers[s], originalMessage, data );
			}
		}
	}

	/**
	 *
	 * @param message
	 * @param data
	 * @param immediateExceptions
	 * @returns {Function|null}
	 * @private
	 */
	_createDeliveryFunction( message, data, immediateExceptions ){
		return  ()=>{
			var topic = String( message ),
				position = topic.lastIndexOf( '.' );

			// deliver the message as it is now
			this._deliverMessage(message, message, data, immediateExceptions);

			// trim the hierarchy and deliver message to each level
			while( position !== -1 ){
				topic = topic.substr( 0, position );
				position = topic.lastIndexOf('.');
				this._deliverMessage( message, topic, data, immediateExceptions );
			}

			this._deliverMessage(message, PubSub.ALL_SUBSCRIBING_MSG, data, immediateExceptions);
		};
	}

	/**
	 *
	 * @param message
	 * @returns {boolean}
	 * @private
	 */
	_hasDirectSubscribersFor( message ) {
		var topic = String( message ),
			found = Boolean(Object.prototype.hasOwnProperty.call( PubSub.messages, topic ) &amp;&amp; this._hasKeys(PubSub.messages[topic]));

		return found;
	}

	/**
	 *
	 * @param message
	 * @returns {boolean}
	 * @private
	 */
	_messageHasSubscribers( message ){
		var topic = String( message ),
			found = this._hasDirectSubscribersFor(topic) || this._hasDirectSubscribersFor(PubSub.ALL_SUBSCRIBING_MSG),
			position = topic.lastIndexOf( '.' );

		while ( !found &amp;&amp; position !== -1 ){
			topic = topic.substr( 0, position );
			position = topic.lastIndexOf( '.' );
			found = this._hasDirectSubscribersFor(topic);
		}

		return found;
	}

	/**
	 *
	 * @param message
	 * @param data
	 * @param sync
	 * @param immediateExceptions
	 * @returns {boolean}
	 * @private
	 */
	_publish( message, data, sync, immediateExceptions ){
		message = (typeof message === 'symbol') ? message.toString() : message;

		var deliver = this._createDeliveryFunction( message, data, immediateExceptions ),
			hasSubscribers = this._messageHasSubscribers( message );

		if ( !hasSubscribers ){
			return false;
		}

		if ( sync === true ){
			deliver();
		} else {
			setTimeout( deliver, 0 );
		}
		return true;
	}
	/**
	 * Publishes the message, passing the data to it's subscribers
	 * @param { String } message The message to publish
	 * @param {} data The data to pass to subscribers
	 * @return { Boolean }
	 */

	static publish ( message, data ){
		return  PubSub.getInstance._publish ( message, data, false, PubSub.immediateExceptions );
	};

}


</code></pre>
		</article>
	</section>
</div>
<br class="clear">
<footer>
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Sep 16 2021 19:01:55
	GMT+0200 (heure d’été d’Europe centrale) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>
<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/search.js" defer></script>
<script src="scripts/collapse.js" defer></script>
</body>
</html>
