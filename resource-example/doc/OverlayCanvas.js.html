<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>OverlayCanvas.js - Documentation</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ArrayExtd.html">ArrayExtd</a><ul class='methods'><li data-type='method' title='get of ArrayExtd'  style='display: none;'><a href="ArrayExtd.html#get">get</a></li></ul></li><li><a href="Cr.html">Cr</a><ul class='methods'><li data-type='method' title='dataSize of Cr'  style='display: none;'><a href="Cr.html#.dataSize">dataSize</a></li><li data-type='method' title='getFile of Cr'  style='display: none;'><a href="Cr.html#.getFile">getFile</a></li><li data-type='method' title='importScript of Cr'  style='display: none;'><a href="Cr.html#.importScript">importScript</a></li></ul></li><li><a href="cwui.html">cwui</a><ul class='members'><li data-type='member' style='display: none;'><a href="cwui.html#.activateKeyEvents">activateKeyEvents</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.customRoutines">customRoutines</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.fileCache">fileCache</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.imagesUrl">imagesUrl</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.pageTransition">pageTransition</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.resizables">resizables</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.trackedEvents">trackedEvents</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.transitions">transitions</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.vKeyboard">vKeyboard</a></li></ul><ul class='methods'><li data-type='method' title='_AddEvent of cwui'  style='display: none;'><a href="cwui.html#._AddEvent">_AddEvent</a></li><li data-type='method' title='_ClearFingerActions of cwui'  style='display: none;'><a href="cwui.html#._ClearFingerActions">_ClearFingerActions</a></li><li data-type='method' title='_ClearImageFrameRate of cwui'  style='display: none;'><a href="cwui.html#._ClearImageFrameRate">_ClearImageFrameRate</a></li><li data-type='method' title='_eventExist of cwui'  style='display: none;'><a href="cwui.html#._eventExist">_eventExist</a></li><li data-type='method' title='_GetRoutine of cwui'  style='display: none;'><a href="cwui.html#._GetRoutine">_GetRoutine</a></li><li data-type='method' title='_InitNewPage of cwui'  style='display: none;'><a href="cwui.html#._InitNewPage">_InitNewPage</a></li><li data-type='method' title='_NeutralizePageEvents of cwui'  style='display: none;'><a href="cwui.html#._NeutralizePageEvents">_NeutralizePageEvents</a></li><li data-type='method' title='_performWhenAllImgsLoaded of cwui'  style='display: none;'><a href="cwui.html#._performWhenAllImgsLoaded">_performWhenAllImgsLoaded</a></li><li data-type='method' title='_prepareTransition of cwui'  style='display: none;'><a href="cwui.html#._prepareTransition">_prepareTransition</a></li><li data-type='method' title='_RemoveEvent of cwui'  style='display: none;'><a href="cwui.html#._RemoveEvent">_RemoveEvent</a></li><li data-type='method' title='_RemovePreviousPage of cwui'  style='display: none;'><a href="cwui.html#._RemovePreviousPage">_RemovePreviousPage</a></li><li data-type='method' title='_SetImageURL of cwui'  style='display: none;'><a href="cwui.html#._SetImageURL">_SetImageURL</a></li><li data-type='method' title='_Transition__cross_fade of cwui'  style='display: none;'><a href="cwui.html#._Transition__cross_fade">_Transition__cross_fade</a></li><li data-type='method' title='_Transition__fade_to_black of cwui'  style='display: none;'><a href="cwui.html#._Transition__fade_to_black">_Transition__fade_to_black</a></li><li data-type='method' title='addCustom of cwui'  style='display: none;'><a href="cwui.html#.addCustom">addCustom</a></li><li data-type='method' title='bindVKeyboard of cwui'  style='display: none;'><a href="cwui.html#.bindVKeyboard">bindVKeyboard</a></li><li data-type='method' title='cancelConnect of cwui'  style='display: none;'><a href="cwui.html#.cancelConnect">cancelConnect</a></li><li data-type='method' title='getById of cwui'  style='display: none;'><a href="cwui.html#.getById">getById</a></li><li data-type='method' title='onKeyDown of cwui'  style='display: none;'><a href="cwui.html#.onKeyDown">onKeyDown</a></li><li data-type='method' title='onKeyUp of cwui'  style='display: none;'><a href="cwui.html#.onKeyUp">onKeyUp</a></li><li data-type='method' title='registerElements of cwui'  style='display: none;'><a href="cwui.html#.registerElements">registerElements</a></li><li data-type='method' title='reloadStyleSheets of cwui'  style='display: none;'><a href="cwui.html#.reloadStyleSheets">reloadStyleSheets</a></li><li data-type='method' title='resizeAll of cwui'  style='display: none;'><a href="cwui.html#.resizeAll">resizeAll</a></li><li data-type='method' title='setInnerHTML of cwui'  style='display: none;'><a href="cwui.html#.setInnerHTML">setInnerHTML</a></li><li data-type='method' title='showDialog of cwui'  style='display: none;'><a href="cwui.html#.showDialog">showDialog</a></li><li data-type='method' title='userCallback of cwui'  style='display: none;'><a href="cwui.html#.userCallback">userCallback</a></li><li data-type='method' title='_BodyTransition of cwui'  style='display: none;'><a href="cwui.html#_BodyTransition">_BodyTransition</a></li></ul></li><li><a href="documentExtd.html">documentExtd</a><ul class='methods'><li data-type='method' title='transformXHTMLToDom of documentExtd'  style='display: none;'><a href="documentExtd.html#.transformXHTMLToDom">transformXHTMLToDom</a></li></ul></li><li><a href="FileCache.html">FileCache</a><ul class='methods'><li data-type='method' title='load of FileCache'  style='display: none;'><a href="FileCache.html#load">load</a></li></ul></li><li><a href="FingerActions.html">FingerActions</a><ul class='methods'><li data-type='method' title='Bind of FingerActions'  style='display: none;'><a href="FingerActions.html#Bind">Bind</a></li><li data-type='method' title='Clear of FingerActions'  style='display: none;'><a href="FingerActions.html#Clear">Clear</a></li></ul></li><li><a href="GenericCache.html">GenericCache</a><ul class='methods'><li data-type='method' title='get of GenericCache'  style='display: none;'><a href="GenericCache.html#get">get</a></li></ul></li><li><a href="HTMLElementExtd.html">HTMLElementExtd</a><ul class='members'><li data-type='member' style='display: none;'><a href="HTMLElementExtd.html#.innerXHTML">innerXHTML</a></li></ul><ul class='methods'><li data-type='method' title='appendChildNodes of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#appendChildNodes">appendChildNodes</a></li><li data-type='method' title='getJs of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#getJs">getJs</a></li><li data-type='method' title='getParentByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#getParentByCssSelector">getParentByCssSelector</a></li><li data-type='method' title='moveStyleSheet of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#moveStyleSheet">moveStyleSheet</a></li><li data-type='method' title='nextSiblingByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#nextSiblingByCssSelector">nextSiblingByCssSelector</a></li><li data-type='method' title='nextSiblingByTagName of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#nextSiblingByTagName">nextSiblingByTagName</a></li><li data-type='method' title='previousSiblingByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#previousSiblingByCssSelector">previousSiblingByCssSelector</a></li><li data-type='method' title='previousSiblingByTagName of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#previousSiblingByTagName">previousSiblingByTagName</a></li><li data-type='method' title='removeComments of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#removeComments">removeComments</a></li></ul></li><li><a href="ImageFrameRate.html">ImageFrameRate</a><ul class='methods'><li data-type='method' title='Clear of ImageFrameRate'  style='display: none;'><a href="ImageFrameRate.html#Clear">Clear</a></li><li data-type='method' title='Set of ImageFrameRate'  style='display: none;'><a href="ImageFrameRate.html#Set">Set</a></li></ul></li><li><a href="mainCwui.html">mainCwui</a><ul class='methods'><li data-type='method' title='_BodyTransition of mainCwui'  style='display: none;'><a href="mainCwui.html#_BodyTransition">_BodyTransition</a></li><li data-type='method' title='execCommand of mainCwui'  style='display: none;'><a href="mainCwui.html#execCommand">execCommand</a></li><li data-type='method' title='initWebSock of mainCwui'  style='display: none;'><a href="mainCwui.html#initWebSock">initWebSock</a></li></ul></li><li><a href="OverlayCanvas.html">OverlayCanvas</a><ul class='methods'><li data-type='method' title='circle of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#circle">circle</a></li><li data-type='method' title='circleAlpha of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#circleAlpha">circleAlpha</a></li><li data-type='method' title='clear of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#clear">clear</a></li><li data-type='method' title='path of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#path">path</a></li><li data-type='method' title='rectAlpha of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#rectAlpha">rectAlpha</a></li><li data-type='method' title='rectangle of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#rectangle">rectangle</a></li><li data-type='method' title='resize of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#resize">resize</a></li><li data-type='method' title='text of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#text">text</a></li></ul></li><li><a href="StringExtd.html">StringExtd</a><ul class='methods'><li data-type='method' title='isHTML of StringExtd'  style='display: none;'><a href="StringExtd.html#isHTML">isHTML</a></li><li data-type='method' title='splice of StringExtd'  style='display: none;'><a href="StringExtd.html#splice">splice</a></li></ul></li><li><a href="Vector.html">Vector</a><ul class='methods'><li data-type='method' title='Amplitude of Vector'  style='display: none;'><a href="Vector.html#Amplitude">Amplitude</a></li><li data-type='method' title='BaryCenter of Vector'  style='display: none;'><a href="Vector.html#BaryCenter">BaryCenter</a></li><li data-type='method' title='DotProd of Vector'  style='display: none;'><a href="Vector.html#DotProd">DotProd</a></li><li data-type='method' title='IsNull of Vector'  style='display: none;'><a href="Vector.html#IsNull">IsNull</a></li><li data-type='method' title='Normalize of Vector'  style='display: none;'><a href="Vector.html#Normalize">Normalize</a></li><li data-type='method' title='Substract of Vector'  style='display: none;'><a href="Vector.html#Substract">Substract</a></li></ul></li><li><a href="VirtualKeyboard.html">VirtualKeyboard</a><ul class='methods'><li data-type='method' title='Bind of VirtualKeyboard'  style='display: none;'><a href="VirtualKeyboard.html#Bind">Bind</a></li><li data-type='method' title='Map of VirtualKeyboard'  style='display: none;'><a href="VirtualKeyboard.html#Map">Map</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#autoReplaceVariables">autoReplaceVariables</a></li><li><a href="global.html#CWUI">CWUI</a></li><li><a href="global.html#dataSize">dataSize</a></li><li><a href="global.html#delegate">delegate</a></li><li><a href="global.html#downloadAsFile">downloadAsFile</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#getCustomStyles">getCustomStyles</a></li><li><a href="global.html#getMock">getMock</a></li><li><a href="global.html#loadFile">loadFile</a></li><li><a href="global.html#loadFileAsync">loadFileAsync</a></li><li><a href="global.html#replaceVariables">replaceVariables</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">OverlayCanvas.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * class OverlayCanvas
 *
 * @classdesc deal with a canvas overlaying a reference div
 */
class OverlayCanvas
{
	/**
	 *
	 * @description Append a canvas element below reference div, access its 2d context,
	 * adjust it to the current reference image dimension, set default styles
	 * and create an internal cache
	 * @param _referenceDivId
	 */
	constructor( _referenceDivId ) {
		this.referenceDiv = document.getElementById( _referenceDivId );
		this.canvasElement = document.createElement( "canvas" );
		this.canvasElement.style.position = "absolute";
		this.canvasElement.style.pointerEvents = "none";
		this.referenceDiv.parentElement.appendChild( this.canvasElement );
		this.context = this.canvasElement.getContext( "2d" );
		this.resize();
		this.defaultStyles = {
			fillStyle: "white",
			strokeStyle: "white",
			shadowColor: "black",
			shadowBlur: 0,
			shadowOffsetX: 0,
			shadowOffsetY: 0,
			lineCap: "square", // butt | round | square
			lineJoin: "miter", // bevel | round | miter
			lineWidth: 1,
			miterLimit: 10,
			closePath: false,
			lineDash: "solid",
			font: "12px arial",
			fill: "true"
		};
		this.lineDashStyles = {
			solid: [],
			dotted: [ 1, 2 ],
			dashed: [ 5, 2 ]
		};
		this.cache = new GenericCache();
	}


	/**
	 * Get and apply color, styles &amp; shadows on current context
	 *
	 * @param _className
	 * @returns {*}
	 * @private
	 */
	_applyStyle( _className ) {
		var style = this.cache.get( "class-" + _className, ()=>{
			return getCustomStyles( _className, this.cache.get( "defaultStylesNames", ()=>{
				var styles = [];
				Object.entries( this.defaultStyles ).forEach( ( [ _name ] )=>{
					styles.push( _name );
				} );
				return styles;
			} ) );
		} );
		Object.entries( this.defaultStyles ).forEach( ( [ _name, _value ] )=>{
			if( typeof this.context[ _name ] !== "function" )
				this.context[ _name ] = style[ _name ] || _value;
		} );
		return style;
	}

	/**
	 * Get dash style, adapted to current line width
	 *
	 * @param _style
	 * @returns {[]}
	 * @private
	 */
	_getDash( _style ) {
		var dash = [];
		this.lineDashStyles[ _style.lineDash || this.defaultStyles.lineDash ].forEach( ( _dash )=>{
			dash.push( _dash * _style.lineWidth );
		} );
		return dash;
	}


	/**
	 * Resize the canvas depending of current reference div dimensions
	 */
	resize() {
		this.canvasElement.width = this.referenceDiv.offsetWidth;
		this.canvasElement.height = this.referenceDiv.offsetHeight;
	}


	/**
	 * Clear current canvas content
	 *
	 * @param preserveTransform
	 */
	clear(preserveTransform) {
		if(preserveTransform) {
			this.context.save();
			this.context.setTransform(1, 0, 0, 1, 0, 0);
		}
		this.context.clearRect( 0, 0, this.canvasElement.width, this.canvasElement.height );
		if (preserveTransform) {
			this.context.restore();
		}
    }

	/**
	 * Draw a path on the canvas
	 * (_path: [ [ x, y ], [ x, y ], ... ])
	 *
	 * @param _path
	 * @param _class
	 * @param _closePath
	 */
	path( _path, _class, _closePath = false ) {
		var style = this._applyStyle( _class );
		this.context.setLineDash( this._getDash( style ) );
		this.context.beginPath();
		for( var i = 0; i &lt; _path.length; i++ )
			this.context[ i == 0 ? "moveTo" : "lineTo" ]( _path[ i ][ 0 ], _path[ i ][ 1 ] );
		if( style.closePath || _closePath )
			this.context.closePath();
		this.context.stroke();
		if( _path.length > 2 )
			this.context.fill();
	}

	/**
	 * Draw a rectangle on the canvas
	 * (_rect: [ x, y, width, height ])
	 *
	 * @param _rect
	 * @param _class
	 */
	rectangle( _rect, _class ) {
		this.path( [ [ _rect[ 0 ], _rect[ 1 ] ], [ _rect[ 0 ] + _rect[ 2 ], _rect[ 1 ] ], [ _rect[ 0 ] + _rect[ 2 ], _rect[ 1 ] + _rect[ 3 ] ], [ _rect[ 0 ], _rect[ 1 ] + _rect[ 3 ] ] ], _class, true );
	}

	/**
	 * Draw a rectangle on the canvas
	 * _rect: [ x, y, width, height ]
	 *
	 * @param _rect
	 * @param _alpha
	 * @param _class
	 */
	rectAlpha( _rect, _alpha, _class ) {
		var style = this._applyStyle( _class );
		this.context.setLineDash( this._getDash( style ) );
		this.context.globalAlpha = _alpha;
		this.context.fillRect( _rect[ 0 ], _rect[ 1 ], _rect[ 2 ], _rect[ 3 ] );
		this.context.globalAlpha = 1;
		this.context.strokeRect( _rect[ 0 ], _rect[ 1 ], _rect[ 2 ], _rect[ 3 ] );
	}


	/**
	 * Draw a circle on the canvas
	 * _pos: [ x, y, radius ]
	 *
	 * @param _pos
	 * @param _alpha
	 * @param _class
	 */
	circleAlpha( _pos, _alpha, _class ) {
		var style = this._applyStyle( _class );
		this.context.setLineDash( this._getDash( style ) );
		this.context.beginPath();
		this.context.arc(_pos[0], _pos[1], _pos[2], 0, 2 * Math.PI);
		this.context.stroke();
		this.context.globalAlpha = _alpha;
		this.context.fill();
		this.context.globalAlpha = 1;
	}

	/**
     * Draw a circle on the canvas
     * (_pos: [ x, y, radius ])
	 *
     * @param _pos
     * @param _class
     */
	circle( _pos, _class ) {
		var style = this._applyStyle( _class );
		this.context.setLineDash( this._getDash( style ) );
		this.context.beginPath();
		this.context.arc(_pos[0], _pos[1], _pos[2], 0, 2 * Math.PI);
		this.context.stroke();
		if ( style.fill == "true")
			this.context.fill();
	}

    /**
     * Draw a text on the canvas
     * _pos: [ x, y ]
     *
     * @param _pos
     * @param _text
     * @param _class
     */
	text( _pos, _text, _class ) {
		var style = this._applyStyle( _class );
		this.context.font = style.font;
		this.context.fillText( _text, _pos[ 0 ], _pos[ 1 ] );
	}
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sun Aug 29 2021 11:06:38 GMT+0200 (heure d’été d’Europe centrale) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
