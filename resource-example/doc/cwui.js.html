<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>cwui.js - Documentation</title><meta property="og:title" content=""/><meta property="og:type" content="website"/><meta property="og:image" content=""/><meta property="og:url" content=""/><script src="scripts/prettify/prettify.js"></script><script src="scripts/prettify/lang-css.js"></script><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><link type="text/css" rel="stylesheet" href="styles/prettify.css"><link type="text/css" rel="stylesheet" href="styles/jsdoc.css"><script src="scripts/nav.js" defer></script><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body><input type="checkbox" id="nav-trigger" class="nav-trigger" /><label for="nav-trigger" class="navicon-button x"><div class="navicon"></div></label><label for="nav-trigger" class="overlay"></label><nav class="wrap"><input type="text" id="nav-search" placeholder="Search" /><h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ArrayExtd.html">ArrayExtd</a><ul class='methods'><li data-type='method' title='get of ArrayExtd'  style='display: none;'><a href="ArrayExtd.html#get">get</a></li></ul></li><li><a href="Cr.html">Cr</a><ul class='methods'><li data-type='method' title='dataSize of Cr'  style='display: none;'><a href="Cr.html#.dataSize">dataSize</a></li><li data-type='method' title='getFile of Cr'  style='display: none;'><a href="Cr.html#.getFile">getFile</a></li><li data-type='method' title='importScript of Cr'  style='display: none;'><a href="Cr.html#.importScript">importScript</a></li></ul></li><li><a href="cwui.html">cwui</a><ul class='members'><li data-type='member' style='display: none;'><a href="cwui.html#.activateKeyEvents">activateKeyEvents</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.customRoutines">customRoutines</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.fileCache">fileCache</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.imagesUrl">imagesUrl</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.pageTransition">pageTransition</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.resizables">resizables</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.trackedEvents">trackedEvents</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.transitions">transitions</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.vKeyboard">vKeyboard</a></li></ul><ul class='methods'><li data-type='method' title='_AddEvent of cwui'  style='display: none;'><a href="cwui.html#._AddEvent">_AddEvent</a></li><li data-type='method' title='_ClearFingerActions of cwui'  style='display: none;'><a href="cwui.html#._ClearFingerActions">_ClearFingerActions</a></li><li data-type='method' title='_ClearImageFrameRate of cwui'  style='display: none;'><a href="cwui.html#._ClearImageFrameRate">_ClearImageFrameRate</a></li><li data-type='method' title='_eventExist of cwui'  style='display: none;'><a href="cwui.html#._eventExist">_eventExist</a></li><li data-type='method' title='_GetRoutine of cwui'  style='display: none;'><a href="cwui.html#._GetRoutine">_GetRoutine</a></li><li data-type='method' title='_InitNewPage of cwui'  style='display: none;'><a href="cwui.html#._InitNewPage">_InitNewPage</a></li><li data-type='method' title='_NeutralizePageEvents of cwui'  style='display: none;'><a href="cwui.html#._NeutralizePageEvents">_NeutralizePageEvents</a></li><li data-type='method' title='_performWhenAllImgsLoaded of cwui'  style='display: none;'><a href="cwui.html#._performWhenAllImgsLoaded">_performWhenAllImgsLoaded</a></li><li data-type='method' title='_prepareTransition of cwui'  style='display: none;'><a href="cwui.html#._prepareTransition">_prepareTransition</a></li><li data-type='method' title='_RemoveEvent of cwui'  style='display: none;'><a href="cwui.html#._RemoveEvent">_RemoveEvent</a></li><li data-type='method' title='_RemovePreviousPage of cwui'  style='display: none;'><a href="cwui.html#._RemovePreviousPage">_RemovePreviousPage</a></li><li data-type='method' title='_SetImageURL of cwui'  style='display: none;'><a href="cwui.html#._SetImageURL">_SetImageURL</a></li><li data-type='method' title='_Transition__cross_fade of cwui'  style='display: none;'><a href="cwui.html#._Transition__cross_fade">_Transition__cross_fade</a></li><li data-type='method' title='_Transition__fade_to_black of cwui'  style='display: none;'><a href="cwui.html#._Transition__fade_to_black">_Transition__fade_to_black</a></li><li data-type='method' title='addCustom of cwui'  style='display: none;'><a href="cwui.html#.addCustom">addCustom</a></li><li data-type='method' title='bindVKeyboard of cwui'  style='display: none;'><a href="cwui.html#.bindVKeyboard">bindVKeyboard</a></li><li data-type='method' title='cancelConnect of cwui'  style='display: none;'><a href="cwui.html#.cancelConnect">cancelConnect</a></li><li data-type='method' title='getById of cwui'  style='display: none;'><a href="cwui.html#.getById">getById</a></li><li data-type='method' title='onKeyDown of cwui'  style='display: none;'><a href="cwui.html#.onKeyDown">onKeyDown</a></li><li data-type='method' title='onKeyUp of cwui'  style='display: none;'><a href="cwui.html#.onKeyUp">onKeyUp</a></li><li data-type='method' title='registerElements of cwui'  style='display: none;'><a href="cwui.html#.registerElements">registerElements</a></li><li data-type='method' title='reloadStyleSheets of cwui'  style='display: none;'><a href="cwui.html#.reloadStyleSheets">reloadStyleSheets</a></li><li data-type='method' title='resizeAll of cwui'  style='display: none;'><a href="cwui.html#.resizeAll">resizeAll</a></li><li data-type='method' title='setInnerHTML of cwui'  style='display: none;'><a href="cwui.html#.setInnerHTML">setInnerHTML</a></li><li data-type='method' title='showDialog of cwui'  style='display: none;'><a href="cwui.html#.showDialog">showDialog</a></li><li data-type='method' title='userCallback of cwui'  style='display: none;'><a href="cwui.html#.userCallback">userCallback</a></li><li data-type='method' title='_BodyTransition of cwui'  style='display: none;'><a href="cwui.html#_BodyTransition">_BodyTransition</a></li></ul></li><li><a href="documentExtd.html">documentExtd</a><ul class='methods'><li data-type='method' title='transformXHTMLToDom of documentExtd'  style='display: none;'><a href="documentExtd.html#.transformXHTMLToDom">transformXHTMLToDom</a></li></ul></li><li><a href="FileCache.html">FileCache</a><ul class='methods'><li data-type='method' title='load of FileCache'  style='display: none;'><a href="FileCache.html#load">load</a></li></ul></li><li><a href="FingerActions.html">FingerActions</a><ul class='methods'><li data-type='method' title='Bind of FingerActions'  style='display: none;'><a href="FingerActions.html#Bind">Bind</a></li><li data-type='method' title='Clear of FingerActions'  style='display: none;'><a href="FingerActions.html#Clear">Clear</a></li></ul></li><li><a href="GenericCache.html">GenericCache</a><ul class='methods'><li data-type='method' title='get of GenericCache'  style='display: none;'><a href="GenericCache.html#get">get</a></li></ul></li><li><a href="HTMLElementExtd.html">HTMLElementExtd</a><ul class='members'><li data-type='member' style='display: none;'><a href="HTMLElementExtd.html#.innerXHTML">innerXHTML</a></li></ul><ul class='methods'><li data-type='method' title='appendChildNodes of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#appendChildNodes">appendChildNodes</a></li><li data-type='method' title='getJs of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#getJs">getJs</a></li><li data-type='method' title='getParentByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#getParentByCssSelector">getParentByCssSelector</a></li><li data-type='method' title='moveStyleSheet of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#moveStyleSheet">moveStyleSheet</a></li><li data-type='method' title='nextSiblingByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#nextSiblingByCssSelector">nextSiblingByCssSelector</a></li><li data-type='method' title='nextSiblingByTagName of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#nextSiblingByTagName">nextSiblingByTagName</a></li><li data-type='method' title='previousSiblingByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#previousSiblingByCssSelector">previousSiblingByCssSelector</a></li><li data-type='method' title='previousSiblingByTagName of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#previousSiblingByTagName">previousSiblingByTagName</a></li><li data-type='method' title='removeComments of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#removeComments">removeComments</a></li></ul></li><li><a href="ImageFrameRate.html">ImageFrameRate</a><ul class='methods'><li data-type='method' title='Clear of ImageFrameRate'  style='display: none;'><a href="ImageFrameRate.html#Clear">Clear</a></li><li data-type='method' title='Set of ImageFrameRate'  style='display: none;'><a href="ImageFrameRate.html#Set">Set</a></li></ul></li><li><a href="mainCwui.html">mainCwui</a><ul class='methods'><li data-type='method' title='_BodyTransition of mainCwui'  style='display: none;'><a href="mainCwui.html#_BodyTransition">_BodyTransition</a></li><li data-type='method' title='execCommand of mainCwui'  style='display: none;'><a href="mainCwui.html#execCommand">execCommand</a></li><li data-type='method' title='initWebSock of mainCwui'  style='display: none;'><a href="mainCwui.html#initWebSock">initWebSock</a></li></ul></li><li><a href="OverlayCanvas.html">OverlayCanvas</a><ul class='methods'><li data-type='method' title='circle of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#circle">circle</a></li><li data-type='method' title='circleAlpha of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#circleAlpha">circleAlpha</a></li><li data-type='method' title='clear of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#clear">clear</a></li><li data-type='method' title='path of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#path">path</a></li><li data-type='method' title='rectAlpha of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#rectAlpha">rectAlpha</a></li><li data-type='method' title='rectangle of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#rectangle">rectangle</a></li><li data-type='method' title='resize of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#resize">resize</a></li><li data-type='method' title='text of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#text">text</a></li></ul></li><li><a href="StringExtd.html">StringExtd</a><ul class='methods'><li data-type='method' title='isHTML of StringExtd'  style='display: none;'><a href="StringExtd.html#isHTML">isHTML</a></li><li data-type='method' title='splice of StringExtd'  style='display: none;'><a href="StringExtd.html#splice">splice</a></li></ul></li><li><a href="Vector.html">Vector</a><ul class='methods'><li data-type='method' title='Amplitude of Vector'  style='display: none;'><a href="Vector.html#Amplitude">Amplitude</a></li><li data-type='method' title='BaryCenter of Vector'  style='display: none;'><a href="Vector.html#BaryCenter">BaryCenter</a></li><li data-type='method' title='DotProd of Vector'  style='display: none;'><a href="Vector.html#DotProd">DotProd</a></li><li data-type='method' title='IsNull of Vector'  style='display: none;'><a href="Vector.html#IsNull">IsNull</a></li><li data-type='method' title='Normalize of Vector'  style='display: none;'><a href="Vector.html#Normalize">Normalize</a></li><li data-type='method' title='Substract of Vector'  style='display: none;'><a href="Vector.html#Substract">Substract</a></li></ul></li><li><a href="VirtualKeyboard.html">VirtualKeyboard</a><ul class='methods'><li data-type='method' title='Bind of VirtualKeyboard'  style='display: none;'><a href="VirtualKeyboard.html#Bind">Bind</a></li><li data-type='method' title='Map of VirtualKeyboard'  style='display: none;'><a href="VirtualKeyboard.html#Map">Map</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#autoReplaceVariables">autoReplaceVariables</a></li><li><a href="global.html#CWUI">CWUI</a></li><li><a href="global.html#dataSize">dataSize</a></li><li><a href="global.html#delegate">delegate</a></li><li><a href="global.html#downloadAsFile">downloadAsFile</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#getCustomStyles">getCustomStyles</a></li><li><a href="global.html#getMock">getMock</a></li><li><a href="global.html#loadFile">loadFile</a></li><li><a href="global.html#loadFileAsync">loadFileAsync</a></li><li><a href="global.html#replaceVariables">replaceVariables</a></li></ul></nav><div id="main"><h1 class="page-title">cwui.js</h1><section><article><pre class="prettyprint source linenums"><code>/**
 * @classdesc class abstract cwui
 * @abstract
 */
class cwui {
//using accessible static properties
	/**
	 * @memberOf cwui
	 * @type {[]}
	 */

	static resizables = [];
	/**
	 * @memberOf cwui
	 * @type {[]}
	 */
	static customRoutines = [];
	/**
	 * @memberOf cwui
	 * @type {Object}
	 */
	static pageTransition = {
		initialDelay     : 500,
		div              : null,
		duration         : 0,
		fn               : null,
		prev             : null,
		inProgress       : false,
		sourcedScriptsSrc: [],
		scriptsContent   : [],
		onLoadContent    : null,
		loadedScripts    : 0
	};
	/**
	 * @memberOf cwui
	 * @type {[{fn: function(): void, type: string}, {fn: function(): void, type: string}]}
	 */
	static transitions = [{
		type: "fade-to-black",
		fn  : cwui._Transition__fade_to_black
	},
						  {
							  type: "cross-fade",
							  fn  : cwui._Transition__cross_fade
						  }
	];
	/**
	 * @memberOf cwui
	 * @type {[]}
	 */
	static trackedEvents = [];
	/**
	 * @memberOf cwui
	 * @type {boolean}
	 */
	static activateKeyEvents = false;
	/**
	 * @memberOf cwui
	 * @type {{}}
	 */
	static imagesUrl = {};
	// user accessible object:
	/**
	 * @memberOf cwui
	 * @type {FileCache}
	 */
	static fileCache = new FileCache();
	/**
	 * @memberOf cwui
	 * @type {VirtualKeyboard}
	 */
	static vKeyboard = new VirtualKeyboard();

	// user accessible methods:

	/**
	 * @constructor
	 */
	constructor() {
		if (this.constructor == cwui) {
			throw new Error("This class cannot be instantiated !");
		}
	}

// --- internal functions ---

	/**
	 * Key down event
	 *
	 * @param _event
	 */
	static onKeyDown(_event) {

		if (!cwui.activateKeyEvents)
			return;
		cwui.webSock.send(JSON.stringify({
											 "command": "onKeyDown",
											 "code"   : _event.keyCode,
											 "ctrl"   : _event.ctrlKey,
											 "shift"  : _event.shiftKey,
											 "alt"    : _event.altKey
										 }));
		_event.preventDefault();
	};

	/**
	 * Key up event
	 *
	 * @param _event
	 */
	static onKeyUp(_event) {
		if (!cwui.activateKeyEvents)
			return;
		cwui.webSock.send(JSON.stringify({
											 "command": "onKeyUp",
											 "code"   : _event.keyCode,
											 "ctrl"   : _event.ctrlKey,
											 "shift"  : _event.shiftKey,
											 "alt"    : _event.altKey
										 }));
		_event.preventDefault();
	};


	/**
	 * Connection cancellation
	 *
	 */
	static cancelConnect() {
		fetch("http://" + cwui.context.httpAddress + "connect.cancel");
	};

	/**
	 *  Resize all resizables items
	  */
	static resizeAll() {
		var eResize = new Event("resize");
		cwui.resizables.forEach(_id => cwui.getById(_id).dispatchEvent(eResize));
	};

	/**
	 * Reload all style sheets
	 */
	static reloadStyleSheets() {
		var query = "?reload=" + new Date().getTime();
		document.querySelectorAll("link[rel='stylesheet' ]").forEach(
			_element => _element.href = _element.href.replace(/\?.*|$/, query)
		);
	}

	/**
	 *  Add a user custom js routine
	 *
	 * @param _name
	 * @param _fn
	 */
	static addCustom(_name, _fn) {
		if (cwui.customRoutines.find(_customRoutine => {
			return _customRoutine.name == _name;
		}))
			return console.warn("custom routine '" + _name + "' already registered");
		cwui.customRoutines.push({name: _name, fn: _fn});
	}

	/**
	 * Call a user callback
	 *
	 * @param _name
	 * @param _params
	 * todo Function cbkDone
	 */
	static userCallback(_name, _params, cbkDone) {
		cwui.webSock.send(JSON.stringify({
											 "command": "onUserCallback",
											 "name"   : _name,
											 "params" : _params ? _params : {}
										 }));

		if (typeof cbkDone == 'function') {
			cwui.webSock.addEventListener("message", (_params) => {
				cbkDone.call(_params);
			});
		}
	}

	/**
	 * Element registration
	 */
	static registerElements() {
		var elements = [];
		cwui.pageTransition.div.querySelectorAll("*[id]").forEach(
			_element => {
				if (_element.id != "")
					elements.push(_element.id);
			});
		cwui.webSock.send(JSON.stringify({"command": "onRegistered", "elements": elements}));
	};


	/**
	 * Virtual keyboard binding
	 */
	static bindVKeyboard() {
		cwui.vKeyboard.Bind(cwui.pageTransition.div);
	};

	/**
	 * Get element by id
	 *
	 * @param _id
	 * @param _error
	 * @returns {boolean|Element}
	 */
	static getById(_id, _error = true) {
		var element = cwui.pageTransition.div.querySelector("#" + _id);
		if (!element) {
			var msg = "Unknown element id: " + _id;
			if (_error) console.error(msg);
			else console.warn(msg);
			return false;
		}
		return element;
	};

	/**
	 * Async set innerHTML
	 *
	 * @param _id
	 * @param _content
	 * @returns {Promise&lt;void>}
	 */
	static async setInnerHTML(_id, _content) {
		cwui.getById(_id).innerHTML = _content;
		await new Promise((_resolve) => {
			delegate(() => {
				_resolve();
			});
		});
	};

	/**
	 * Show a global dialog
	 *
	 * @param _text
	 */
	static showDialog(_text) {
		var dialog = document.createElement("div");
		dialog.innerHTML = _text;
		dialog.className = "dialog";
		document.body.append(dialog);
	};


	/* --- internal functions ---*/
	/**
	 * Test an Event if it is exist on element, and return this
	 *
	 * @param _element
	 * @returns {*}
	 */
	static _eventExist(_element, _name) {
		return cwui.trackedEvents.find(
			_event => {
				return _event.element == _element &amp;&amp; _event.name == _name;
			})

	}


	/**
	 *  Add trackable event listener
	 *
	 * @param _element
	 * @param _name
	 * @param _fn
	 */
	static _AddEvent(_element, _name, _fn) {
		if (cwui._eventExist(_element, _name))
			return console.warn("event '" + _name + "' on element '"
								+ _element.id + "' already registered");
		var event = {element: _element, name: _name, fn: _fn};
		cwui.trackedEvents.push(event);
		event.element.addEventListener(event.name, event.fn);
	}


	/**
	 * Remove tracked event
	 *
	 * @param _element
	 * @param _name
	 */
	static _RemoveEvent(_element, _name) {
		var _eventExist = cwui._eventExist(_element, _name);
		if (!_eventExist) return;
		_eventExist.element.removeEventListener(_eventExist.name, _eventExist.fn);
		cwui.trackedEvents = cwui.trackedEvents.filter(item => item !== _eventExist);
	}

	/**
	 * Reset current page events
	 *
	 */
	static _NeutralizePageEvents() {
		// reset everything
		cwui.resizables = [];
		cwui.customRoutines = [];
		cwui.binaryRcv = null;

		// key events
		cwui.activateKeyEvents = false;
		document.removeEventListener("keydown", cwui.onKeyDown);
		document.removeEventListener("keyup", cwui.onKeyUp);

		// clear finger actions &amp; image frame rate
		cwui._ClearFingerActions();
		cwui._ClearImageFrameRate();

		// remove events
		if (!cwui.pageTransition.div)
			return;
		var events = ["click", "wheel", "blur", "keypress", "input", "change", "resize"];
		cwui.pageTransition.div.querySelectorAll("*[id]").forEach(_element => {
			events.forEach((_event) => {
				cwui._RemoveEvent(_element, _event);
			});
		});
	}

	/**
	 * Retrieve a custom routine by its name
	 *
	 * @param _name
	 * @returns {null|*}
	 */
	static _GetRoutine(_name) {
		var routine = cwui.customRoutines.find(_entry => {
			return _entry.name == _name
		});
		if (!routine) {
			console.error("Unknown custom routine: " + _name);
			return null;
		}
		return routine;
	}

	/**
	 * Clear current finger actions
	 *
	 */
	static _ClearFingerActions() {
		if (cwui.fingerActions == null)
			return;
		cwui.fingerActions.Clear();
		delete cwui.fingerActions;
	}

	/**
	 * Clear current image frame rate
	 *
	 */
	static _ClearImageFrameRate() {
		if (cwui.imageFrameRate == null)
			return;
		cwui.imageFrameRate.Clear();
		delete cwui.imageFrameRate;
	}

	/**
	 * Send page initialisation to back-end and
	 * register current page elements
	 *
	 */
	static _InitNewPage() {
		// set finger actions &amp; image frame rate
		cwui.fingerActions = new FingerActions();
		cwui.imageFrameRate = new ImageFrameRate();

		// new page event
		cwui.webSock.send(JSON.stringify({"command": "onNewPage"}));

		// bind virtual keyboard to flagged input elements
		cwui.bindVKeyboard();

		// elements registration
		cwui.registerElements();

		// key events
		document.addEventListener("keydown", cwui.onKeyDown);
		document.addEventListener("keyup", cwui.onKeyUp);
	}


	/**
	 * Relive previous page if any
	 *
	 */
	static _RemovePreviousPage() {
		// remove previous content
		if (cwui.pageTransition.prev)
			document.body.removeChild(cwui.pageTransition.prev);
		cwui.pageTransition.prev = cwui.pageTransition.div;
		cwui.pageTransition.inProgress = false;
	}

	/**
	 * Effective new page transition: fade-to-black
	 *
	 */
	static _Transition__fade_to_black() {
		if (cwui.pageTransition.prev)
			cwui.pageTransition.prev.style.opacity = 0;
		cwui._InitNewPage();
		delegate(() => {
			cwui._RemovePreviousPage();
			cwui.pageTransition.div.style.opacity = 1;
		}, cwui.pageTransition.prev ? cwui.pageTransition.duration : cwui.pageTransition.initialDelay);
	}


	/**
	 * Effective new page transition: cross-fade
	 *
	 */
	static _Transition__cross_fade() {
		if (cwui.pageTransition.prev)
			cwui.pageTransition.prev.style.zIndex = -1;
		cwui._InitNewPage();
		delegate(() => {
			cwui.pageTransition.div.style.opacity = 1;
			delegate(() => {
				cwui._RemovePreviousPage();
			}, cwui.pageTransition.duration);
		}, cwui.pageTransition.prev ? 0 : cwui.pageTransition.initialDelay);
	}


	/**
	 * Set image URL, taking care
	 * of previous URL removal
	 *
	 * @param _id
	 * @param _content
	 */
	static _SetImageURL(_id, _content) {
		if (cwui.imagesUrl[_id] != null)
			window.URL.revokeObjectURL(cwui.imagesUrl[_id]);
		cwui.imagesUrl[_id] = window.URL.createObjectURL(_content);
		cwui.getById(_id).src = cwui.imagesUrl[_id];
	}

	/**
	 * Execute callBack , when all images are loaded
	 *
	 * @param _parentElmt
	 * @param _cbkDone
	 */
	static _performWhenAllImgsLoaded(_parentElmt, _cbkDone) {
		/*		var imgs =_parentElmt.querySelectorAll('img'),
					remainingImgs=imgs.length;
				if(remainingImgs!=0){
					imgs.forEach( _img =>{
						_img.onload =  __img =>{
							if((--remainingImgs)==0) _cbkDone.call();
							__img.onload=null;
						} ;
					});
				}else{
					_cbkDone.call();
				}
			*/


		var images = [];
		cwui.pageTransition.div.querySelectorAll("img").forEach((_element) => {
			var path = _element.src.substring(window.location.href.length);
			if (path != "")
				images.push(path);
		});

		// pre-load images
		var loadedImages = images.length;
		if (images.length == 0)
			cwui.pageTransition.fn();
		images.forEach((_image) => {
			var image = new Image();
			image.addEventListener("load", () => {
				if (--loadedImages != 0)
					return;
				cwui.pageTransition.fn();
			});
			image.src = _image;
		});/**/


	}

	/**
	 * Create a div for future transition
	 * @returns {HTMLDivElement}
	 */
	static _prepareTransition() {
		var elmt = document.createElement("div");
		elmt.classList.toggle('transition-wrapper', true);
		var options = {opacity: "0", transition: cwui.pageTransition.duration + "ms"};
		Object.entries(options).forEach(([_key, _value]) => {
			elmt.style[_key] = _value;
		});
		return elmt;
	}

	/**
	 *  Perform body transition
	 *
	 * @param _data
	 * @param _readOnly
	 * @param _transition
	 * @returns {Promise&lt;void>}
	 */
	async _BodyTransition(_data, _readOnly, _transition) {
		// transition factor depending of transition type
		var transitionFactor = _transition.type == "cross-fade" ? 1 : 0.5;
		cwui.pageTransition.duration = (_readOnly ? 0 : (_transition.duration * transitionFactor)).toFixed();
		cwui.pageTransition.fn = cwui.transitions.find(
			__transition => {
				return __transition.type == _transition.type
			}).fn;

		// wait for previous transition if currently in progress:
		if (cwui.pageTransition.inProgress)
			await (async _resolve => {
				setTimeout(_resolve, cwui.pageTransition.duration);
			});
		cwui.pageTransition.inProgress = true;

		// reset current body events
		cwui._NeutralizePageEvents();

		// affect tween on page Transition div

		//todo  start of Pascal 's code
		cwui.pageTransition.div = cwui._prepareTransition();
		// rename all elmts with id for to avoid duplicate  id betwenn page transition  (a div)
		// prev and div (cwui.pageTransition.prev &amp; cwui.pageTransition.div)
		/*	if(cwui.pageTransition.prev instanceof HTMLElement) cwui.pageTransition.prev.querySelectorAll("*[id]").forEach(elmt=>elmt.id+="_tmp");*/

		// get HTML of _data (an URL of component HTML)
		var xhtml = Cr.getFile(_data);
		// insert new div in general body:
		document.body.insertBefore(cwui.pageTransition.div, document.body.firstElementChild);
		//add html loaded in page transition div element
		cwui.pageTransition.div.innerXHTML = xhtml;
		//wait all imgs laod ended for to execute tween (cwui.pageTransition.fn)
		cwui._performWhenAllImgsLoaded(cwui.pageTransition.div, cwui.pageTransition.fn);

		// call onload (only dom 0) statements events for each tags elments excluded img,body,script
		var eLoad = new Event("load");
		var allElmtsExcludeImgBodyScript = cwui.pageTransition.div.querySelectorAll('*:not(img):not(body):not(script):not(link)');

		allElmtsExcludeImgBodyScript.forEach(_element => {
			if (_element.onload != null) _element.dispatchEvent(eLoad);
		});
		//todo  end of Pascal 's code

	}


}






</code></pre></article></section></div><br class="clear"><footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sat Sep 04 2021 10:29:09 GMT+0200 (heure d’été d’Europe centrale) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer><script>prettyPrint();</script><script src="scripts/polyfill.js"></script><script src="scripts/linenumber.js"></script><script src="scripts/search.js" defer></script><script src="scripts/collapse.js" defer></script></body></html>
