<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>vkeyboard/VKeyboard.js - Documentation</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ArrayExtd.html">ArrayExtd</a><ul class='methods'><li data-type='method' title='get of ArrayExtd'  style='display: none;'><a href="ArrayExtd.html#get">get</a></li></ul></li><li><a href="Cr.html">Cr</a><ul class='methods'><li data-type='method' title='dataSize of Cr'  style='display: none;'><a href="Cr.html#.dataSize">dataSize</a></li><li data-type='method' title='getFile of Cr'  style='display: none;'><a href="Cr.html#.getFile">getFile</a></li><li data-type='method' title='importScript of Cr'  style='display: none;'><a href="Cr.html#.importScript">importScript</a></li></ul></li><li><a href="cwui.html">cwui</a><ul class='members'><li data-type='member' style='display: none;'><a href="cwui.html#.activateKeyEvents">activateKeyEvents</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.customRoutines">customRoutines</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.fileCache">fileCache</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.imagesUrl">imagesUrl</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.pageTransition">pageTransition</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.resizables">resizables</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.trackedEvents">trackedEvents</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.transitions">transitions</a></li><li data-type='member' style='display: none;'><a href="cwui.html#.vKeyboard">vKeyboard</a></li></ul><ul class='methods'><li data-type='method' title='_AddEvent of cwui'  style='display: none;'><a href="cwui.html#._AddEvent">_AddEvent</a></li><li data-type='method' title='_ClearFingerActions of cwui'  style='display: none;'><a href="cwui.html#._ClearFingerActions">_ClearFingerActions</a></li><li data-type='method' title='_ClearImageFrameRate of cwui'  style='display: none;'><a href="cwui.html#._ClearImageFrameRate">_ClearImageFrameRate</a></li><li data-type='method' title='_eventExist of cwui'  style='display: none;'><a href="cwui.html#._eventExist">_eventExist</a></li><li data-type='method' title='_GetRoutine of cwui'  style='display: none;'><a href="cwui.html#._GetRoutine">_GetRoutine</a></li><li data-type='method' title='_InitNewPage of cwui'  style='display: none;'><a href="cwui.html#._InitNewPage">_InitNewPage</a></li><li data-type='method' title='_NeutralizePageEvents of cwui'  style='display: none;'><a href="cwui.html#._NeutralizePageEvents">_NeutralizePageEvents</a></li><li data-type='method' title='_performWhenAllImgsLoaded of cwui'  style='display: none;'><a href="cwui.html#._performWhenAllImgsLoaded">_performWhenAllImgsLoaded</a></li><li data-type='method' title='_prepareTransition of cwui'  style='display: none;'><a href="cwui.html#._prepareTransition">_prepareTransition</a></li><li data-type='method' title='_RemoveEvent of cwui'  style='display: none;'><a href="cwui.html#._RemoveEvent">_RemoveEvent</a></li><li data-type='method' title='_RemovePreviousPage of cwui'  style='display: none;'><a href="cwui.html#._RemovePreviousPage">_RemovePreviousPage</a></li><li data-type='method' title='_SetImageURL of cwui'  style='display: none;'><a href="cwui.html#._SetImageURL">_SetImageURL</a></li><li data-type='method' title='_Transition__cross_fade of cwui'  style='display: none;'><a href="cwui.html#._Transition__cross_fade">_Transition__cross_fade</a></li><li data-type='method' title='_Transition__fade_to_black of cwui'  style='display: none;'><a href="cwui.html#._Transition__fade_to_black">_Transition__fade_to_black</a></li><li data-type='method' title='addCustom of cwui'  style='display: none;'><a href="cwui.html#.addCustom">addCustom</a></li><li data-type='method' title='bindVKeyboard of cwui'  style='display: none;'><a href="cwui.html#.bindVKeyboard">bindVKeyboard</a></li><li data-type='method' title='cancelConnect of cwui'  style='display: none;'><a href="cwui.html#.cancelConnect">cancelConnect</a></li><li data-type='method' title='getById of cwui'  style='display: none;'><a href="cwui.html#.getById">getById</a></li><li data-type='method' title='onKeyDown of cwui'  style='display: none;'><a href="cwui.html#.onKeyDown">onKeyDown</a></li><li data-type='method' title='onKeyUp of cwui'  style='display: none;'><a href="cwui.html#.onKeyUp">onKeyUp</a></li><li data-type='method' title='registerElements of cwui'  style='display: none;'><a href="cwui.html#.registerElements">registerElements</a></li><li data-type='method' title='reloadStyleSheets of cwui'  style='display: none;'><a href="cwui.html#.reloadStyleSheets">reloadStyleSheets</a></li><li data-type='method' title='resizeAll of cwui'  style='display: none;'><a href="cwui.html#.resizeAll">resizeAll</a></li><li data-type='method' title='setInnerHTML of cwui'  style='display: none;'><a href="cwui.html#.setInnerHTML">setInnerHTML</a></li><li data-type='method' title='showDialog of cwui'  style='display: none;'><a href="cwui.html#.showDialog">showDialog</a></li><li data-type='method' title='userCallback of cwui'  style='display: none;'><a href="cwui.html#.userCallback">userCallback</a></li><li data-type='method' title='_BodyTransition of cwui'  style='display: none;'><a href="cwui.html#_BodyTransition">_BodyTransition</a></li></ul></li><li><a href="documentExtd.html">documentExtd</a><ul class='methods'><li data-type='method' title='transformXHTMLToDom of documentExtd'  style='display: none;'><a href="documentExtd.html#.transformXHTMLToDom">transformXHTMLToDom</a></li></ul></li><li><a href="FileCache.html">FileCache</a><ul class='methods'><li data-type='method' title='load of FileCache'  style='display: none;'><a href="FileCache.html#load">load</a></li></ul></li><li><a href="FingerActions.html">FingerActions</a><ul class='methods'><li data-type='method' title='Bind of FingerActions'  style='display: none;'><a href="FingerActions.html#Bind">Bind</a></li><li data-type='method' title='Clear of FingerActions'  style='display: none;'><a href="FingerActions.html#Clear">Clear</a></li></ul></li><li><a href="GenericCache.html">GenericCache</a><ul class='methods'><li data-type='method' title='get of GenericCache'  style='display: none;'><a href="GenericCache.html#get">get</a></li></ul></li><li><a href="HTMLElementExtd.html">HTMLElementExtd</a><ul class='members'><li data-type='member' style='display: none;'><a href="HTMLElementExtd.html#.innerXHTML">innerXHTML</a></li></ul><ul class='methods'><li data-type='method' title='appendChildNodes of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#appendChildNodes">appendChildNodes</a></li><li data-type='method' title='getJs of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#getJs">getJs</a></li><li data-type='method' title='getParentByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#getParentByCssSelector">getParentByCssSelector</a></li><li data-type='method' title='moveStyleSheet of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#moveStyleSheet">moveStyleSheet</a></li><li data-type='method' title='nextSiblingByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#nextSiblingByCssSelector">nextSiblingByCssSelector</a></li><li data-type='method' title='nextSiblingByTagName of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#nextSiblingByTagName">nextSiblingByTagName</a></li><li data-type='method' title='previousSiblingByCssSelector of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#previousSiblingByCssSelector">previousSiblingByCssSelector</a></li><li data-type='method' title='previousSiblingByTagName of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#previousSiblingByTagName">previousSiblingByTagName</a></li><li data-type='method' title='removeComments of HTMLElementExtd'  style='display: none;'><a href="HTMLElementExtd.html#removeComments">removeComments</a></li></ul></li><li><a href="ImageFrameRate.html">ImageFrameRate</a><ul class='methods'><li data-type='method' title='Clear of ImageFrameRate'  style='display: none;'><a href="ImageFrameRate.html#Clear">Clear</a></li><li data-type='method' title='Set of ImageFrameRate'  style='display: none;'><a href="ImageFrameRate.html#Set">Set</a></li></ul></li><li><a href="mainCwui.html">mainCwui</a><ul class='methods'><li data-type='method' title='_BodyTransition of mainCwui'  style='display: none;'><a href="mainCwui.html#_BodyTransition">_BodyTransition</a></li><li data-type='method' title='execCommand of mainCwui'  style='display: none;'><a href="mainCwui.html#execCommand">execCommand</a></li><li data-type='method' title='initWebSock of mainCwui'  style='display: none;'><a href="mainCwui.html#initWebSock">initWebSock</a></li></ul></li><li><a href="OverlayCanvas.html">OverlayCanvas</a><ul class='methods'><li data-type='method' title='circle of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#circle">circle</a></li><li data-type='method' title='circleAlpha of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#circleAlpha">circleAlpha</a></li><li data-type='method' title='clear of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#clear">clear</a></li><li data-type='method' title='path of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#path">path</a></li><li data-type='method' title='rectAlpha of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#rectAlpha">rectAlpha</a></li><li data-type='method' title='rectangle of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#rectangle">rectangle</a></li><li data-type='method' title='resize of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#resize">resize</a></li><li data-type='method' title='text of OverlayCanvas'  style='display: none;'><a href="OverlayCanvas.html#text">text</a></li></ul></li><li><a href="StringExtd.html">StringExtd</a><ul class='methods'><li data-type='method' title='isHTML of StringExtd'  style='display: none;'><a href="StringExtd.html#isHTML">isHTML</a></li><li data-type='method' title='splice of StringExtd'  style='display: none;'><a href="StringExtd.html#splice">splice</a></li></ul></li><li><a href="Vector.html">Vector</a><ul class='methods'><li data-type='method' title='Amplitude of Vector'  style='display: none;'><a href="Vector.html#Amplitude">Amplitude</a></li><li data-type='method' title='BaryCenter of Vector'  style='display: none;'><a href="Vector.html#BaryCenter">BaryCenter</a></li><li data-type='method' title='DotProd of Vector'  style='display: none;'><a href="Vector.html#DotProd">DotProd</a></li><li data-type='method' title='IsNull of Vector'  style='display: none;'><a href="Vector.html#IsNull">IsNull</a></li><li data-type='method' title='Normalize of Vector'  style='display: none;'><a href="Vector.html#Normalize">Normalize</a></li><li data-type='method' title='Substract of Vector'  style='display: none;'><a href="Vector.html#Substract">Substract</a></li></ul></li><li><a href="VirtualKeyboard.html">VirtualKeyboard</a><ul class='methods'><li data-type='method' title='Bind of VirtualKeyboard'  style='display: none;'><a href="VirtualKeyboard.html#Bind">Bind</a></li><li data-type='method' title='Map of VirtualKeyboard'  style='display: none;'><a href="VirtualKeyboard.html#Map">Map</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#autoReplaceVariables">autoReplaceVariables</a></li><li><a href="global.html#CWUI">CWUI</a></li><li><a href="global.html#dataSize">dataSize</a></li><li><a href="global.html#delegate">delegate</a></li><li><a href="global.html#downloadAsFile">downloadAsFile</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#getCustomStyles">getCustomStyles</a></li><li><a href="global.html#getMock">getMock</a></li><li><a href="global.html#loadFile">loadFile</a></li><li><a href="global.html#loadFileAsync">loadFileAsync</a></li><li><a href="global.html#replaceVariables">replaceVariables</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">vkeyboard/VKeyboard.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class
 * generic virtual keyboard
 */
class VirtualKeyboard
{
	/**
	 * Virtual Keyboard ctor: just call initialization
	 * @constructor
 	 */
	constructor() {
		this._Init();
	}

	/**
	 * initialization: load all requiered files and create
	 * a FingerActions object
	 * @async
 	 * @returns {Promise&lt;void>}
	 * @private
	 */
	async _Init() {
		this.fileCache = new FileCache();
		var templates = [ "page", "container", "panel", "row", "key", "single_key", "icon", "lock", "header" ];
		this.templates = {};
		for( var i = 0; i &lt; templates.length; i++ )
			this.templates[ templates[ i ] ] = await this.fileCache.load( "vkeyboard/t_" + templates[ i ] + ".htm" );
		this.keyMap = {};
		this.keyMap[ "num" ] = JSON.parse( await this.fileCache.load( "vkeyboard/num.json" ) );
		this.mapList = [ "eng", "fra" ];
		for( var i = 0; i &lt; this.mapList.length; i++ )
			this.keyMap[ "alpha_" + this.mapList[ i ] ] = JSON.parse( await this.fileCache.load( "vkeyboard/alpha_" + this.mapList[ i ] + ".json" ) );
		this.referenceElement = null;
		this.fa = new FingerActions();
		this.Map();
	}

	/**
	 *  bind current virtual keyboard over input element candidates
	 *
	 * @param _div
	 */
	Bind( _div ) {
		_div.querySelectorAll( "input[vkeyboard]" ).forEach( ( _element )=>{
			// show the virtual keyboard when clicking on the input
			_element.addEventListener( "focus", ()=>{
				_element.blur();
				this._Show( _element );
			} );
		} );
	}

	/**
	 * change virtual keyboard mapping: if currently opening,
	 * perform a live content reloading
	 * @param _lang
	 */
	Map( _lang ) {
		this.lang = _lang;
		if( this.referenceElement )
			this._Build();
	}

	/**show the virtual keyboard, related to a given element:
	 * - set done setter function to reinject the input value
	 * - extract current input configuration
	 * - get current input value as default
	 * - build the virtual keyboard using configuration
	 * - display the keyboard
	 * @param _element
	 * @private
	 */
	_Show( _element ) {
		this.referenceElement = _element;
		this.kbElement = document.getElementById( "virtual-keyboard" );
		this.fnDone = ( _value )=>{
			_element.value = _value;
			_element.dispatchEvent( new Event( "change" ) );
		};
		this.config = {
			password: _element.getAttribute( "type" ) == "password",
			min: _element.getAttribute( "min" ) || 0,
			max: _element.getAttribute( "max" ) || 1000,
			digit: _element.getAttribute( "inputmode" ) == "numeric"
		};
		this.defaultValue = _element.value;
		this.value = this.defaultValue;
		this._Build();
		delegate( ()=>{
			this.kbElement.style.display = "flex";
		} );
	}

	/**
	 * build the virtual keyboard by creating DOM content
	 * @private
	 */
	_Build() {
		this.keyId = 1;
		this.action = "std";
		this.lock = false;
		this.temporaryAction = "";
		this.temporaryKey = null;
		this.valid = true;
		this.mainChars = [];
		var container_bottom = "";
		var lang = this.mapList.find( ( _lang )=>{ return _lang == this.lang; } ) || "eng";
		container_bottom += replaceVariables( this.templates.panel, [ [ "pos", "left" ], [ "content", this._DumpPanel( "alpha_" + lang ) ] ] );
		container_bottom += replaceVariables( this.templates.panel, [ [ "pos", "right" ], [ "content", this._DumpPanel( "num" ) ] ] );
		var content = "";
		content += replaceVariables( this.templates.container, [ [ "pos", "top" ], [ "content", replaceVariables( this.templates.header, [] ) ] ] );
		content += replaceVariables( this.templates.container, [ [ "pos", "bottom" ], [ "content", container_bottom ] ] );
		this.kbElement.innerHTML = replaceVariables( this.templates.page, [ [ "content", content ] ] );
		this._UpdateValue();
		this._HeaderActions();
	}

	/**
	 * called when closing the virtual keyboard: call
	 * the setter function and hide the virtual keyboard
	 * @param _value
	 * @private
	 */
	_Done( _value ) {
		this.fnDone( _value );
		this.referenceElement = null;
		this.kbElement.style.display = "none";
	}

	/**
	 * set header actions (cancel, clear, ok and input field)
	 * @private
	 */
	_HeaderActions() {
		delegate( ()=>{
			var virtual_keyboard_cancel = document.getElementById( "virtual-keyboard-cancel" );
			this.fa.Bind( virtual_keyboard_cancel, { onFingerPress: ()=>{
					virtual_keyboard_cancel.classList.add( "active" );
					this._Done( this.defaultValue );
				}, onFingerRelease: ()=>{
					virtual_keyboard_cancel.classList.remove( "active" );
				}
			} );
			var virtual_keyboard_clear = document.getElementById( "virtual-keyboard-clear" );
			this.fa.Bind( virtual_keyboard_clear, { onFingerPress: ()=>{
					virtual_keyboard_clear.classList.add( "active" );
					this.value = this.defaultValue;
					this._UpdateValue();
				}, onFingerRelease: ()=>{
					virtual_keyboard_clear.classList.remove( "active" );
				}
			} );
			var virtual_keyboard_ok = document.getElementById( "virtual-keyboard-ok" );
			this.fa.Bind( virtual_keyboard_ok, { onFingerPress: ()=>{
					virtual_keyboard_ok.classList.add( "active" );
					this._Done( this.value );
				}, onFingerRelease: ()=>{
					virtual_keyboard_ok.classList.remove( "active" );
				}
			} );
			var valueElement = document.getElementById( "virtual-keyboard-value" );
			valueElement.addEventListener( "input", ()=>{
				this.value = valueElement.value;
				this._UpdateValue();
			} );
			valueElement.addEventListener( "keyup", ( _event )=>{
				if( _event.keyCode === 13 &amp;&amp; this.valid )
					this._Done( this.value );
			} );
			valueElement.setAttribute( "type", this.config.password ? "password" : "text" );
			this._ScrollInput();
		} );
	}

	/**
	 * automatically scroll right in the input field, eventually
	 * set focus on non-mobile devices (allowing alternative
	 * real keyboard usage by default)
	 * @private
	 */
	_ScrollInput() {
		var valueElement = document.getElementById( "virtual-keyboard-value" );
		valueElement.setSelectionRange( valueElement.value.length, valueElement.value.length );
		valueElement.scrollLeft = valueElement.scrollWidth;
		delegate( ()=>{
			if( ! /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test( navigator.userAgent ) )
				valueElement.focus();
		} );
	}

	/**
	 * dump a given panel (alphabetical or numerical)
	 * @param _name
	 * @returns {string}
	 * @private
	 */
	_DumpPanel( _name ){
		var content = "";
		this.keyMap[ _name ].forEach( ( _row )=>{ content += this._DumpRow( _row ); } );
		return content;
	}

	/**
	 *  switch virtual keyboard to a specific key location (std, shift or alt)
	 * @param _action
	 * @private
	 */
	_SwitchTo( _action ) {
		for( var i = 1; i &lt; this.keyId; i++ ) {
			var prevElement = document.getElementById( "virtual-keyboard-high-" + this.action + i );
			if( prevElement )
				prevElement.classList.remove( "highlight" );
			var newElement = document.getElementById( "virtual-keyboard-high-" + _action + i );
			if( newElement )
				newElement.classList.add( "highlight" );
		}
		this.action = _action;
	}

	/**
	 * update the current value of the input field, check for digt restriction, validity and scroll right
	 * @private
	 */
	_UpdateValue() {
		delegate( ()=>{
			if( this.config.digit )
				this.value = this.value.replace( /[^\d]/g, "" );
			this._CheckValidity();
			document.getElementById( "virtual-keyboard-value" ).value = this.value;
			this._ScrollInput();
		} );
	}

	/**
	 * check for value validity regarding constraints (min &amp; max data length)
	 * @private
	 */
	_CheckValidity() {
		var valid = this.value.length >= this.config.min &amp;&amp; this.value.length &lt;= this.config.max;
		if( this.valid == valid )
			return;
		if( valid )
			document.getElementById( "virtual-keyboard-ok" ).classList.remove( "invalid" );
		else
			document.getElementById( "virtual-keyboard-ok" ).classList.add( "invalid" );
		this.valid = valid;
	}

	/**
	 * clear current temporary
	 * @private
	 */
	_ClearTemporary() {
		this._SwitchTo( this.lock ? "shift" : "std" );
		document.getElementById( this.temporaryKey ).classList.remove( "active" );
		if( this.temporaryAction != "alt" )
			this._TransformMainChars( this.lock );
		this.temporaryAction = "";
		this.temporaryKey = null;
	}

	/**
	 * common finger actions related to shift &amp; alt keys
	 * @param _key_id
	 * @param _fn
	 * @private
	 */
	_ShiftAltActions( _key_id, _fn ) {
		delegate( ()=>{
			var key = document.getElementById( _key_id );
			this.fa.Bind( key, { onFingerPress: ()=>{
					var temporaryIsAction = _key_id == this.temporaryKey;
					if( this.temporaryKey != null ) {
						this._ClearTemporary();
						if( temporaryIsAction )
							return;
					}
					key.classList.add( "active" );
					var action = _fn();
					this._SwitchTo( action );
					if( action != "alt" )
						this._TransformMainChars( !this.lock );
					this.temporaryAction = action;
					this.temporaryKey = _key_id;
				}, onFingerRelease: ()=>{}
			} );
		} );
	}

	/**
	 * transform main chars
	 * @param _uppercase
	 * @private
	 */
	_TransformMainChars( _uppercase ) {
		this.mainChars.forEach( ( _id )=>{
			var char = document.getElementById( _id );
			if( _uppercase )
				char.classList.remove( "lowercase" );
			else
				char.classList.add( "lowercase" );
		} );
	}

	/**
	 * finger action of the lock key
	 * @param _key_id
	 * @private
	 */
	_LockAction( _key_id ) {
		delegate( ()=>{
			var key = document.getElementById( _key_id );
			this.fa.Bind( key, { onFingerPress: ()=>{
					key.classList.add( "active" );
				}, onFingerRelease: ()=>{
					key.classList.remove( "active" );
					if( this.lock ) {
						document.getElementById( _key_id + "lock" ).classList.remove( "on" );
						this._SwitchTo( "std" );
						this.lock = false;
						this._TransformMainChars( false );
						return;
					}
					document.getElementById( _key_id + "lock" ).classList.add( "on" );
					this._SwitchTo( "shift" );
					this.lock = true;
					this._TransformMainChars( true );
				}
			} );
		} );
	}

	/**
	 * finger action of the backspace key
	 * @param _key_id
	 * @private
	 */
	_BackSpaceAction( _key_id ) {
		delegate( ()=>{
			var key = document.getElementById( _key_id );
			this.fa.Bind( key, { onFingerPress: ()=>{
					key.classList.add( "active" );
					if( !this.value )
						return;
					this.value = this.value.slice( 0, -1 );
					this._UpdateValue();
				}, onFingerRelease: ()=>{
					key.classList.remove( "active" );
				}
			} );
		} );
	}

	/**
	 * 	default finger action (dump selected character)
	 * @param _key_id
	 * @param _col
	 * @private
	 */
	_DefaultAction( _key_id, _col ) {
		delegate( ()=>{
			var key = document.getElementById( _key_id );
			this.fa.Bind( key, { onFingerPress: ()=>{
					key.classList.add( "active" );
					var character = this.action == "std" ? _col[ 1 ] : ( this.action == "shift" ? _col[ 0 ] : _col[ 2 ] );
					if( !character )
						character = this.action == "alt" &amp;&amp; this.lock ? _col[ 0 ].toUpperCase() : _col[ 0 ].toLowerCase();
					this.value += character;
					this._UpdateValue();
					if( this.temporaryAction != "" )
						this._ClearTemporary();
				}, onFingerRelease: ()=>{
					key.classList.remove( "active" );
				}
			} );
		} );
	}

	/**
	 * dump a whole row of keys
	 * @param _row
	 * @returns {*}
	 * @private
	 */
	_DumpRow( _row ){
		var content = "";
		_row.forEach( ( _col )=>{
			var id = _col[ 5 ] ? 0 : this.keyId;
			var key_id = "virtual-keyboard-key-" + this.keyId++;
			if( _col[ 0 ] >= 'A' &amp;&amp; _col[ 0 ] &lt;= 'Z' )
				this.mainChars.push( "char-" + key_id );
			var shift = _col[ 0 ];
			switch( _col[ 5 ] ) {
				case "shift":
					this._ShiftAltActions( key_id, ()=>{ return this.lock ? "std" : "shift"; } );
					shift = replaceVariables( this.templates.icon, [ [ "icon", "shift" ] ] );
					break;

				case "alt":
					this._ShiftAltActions( key_id, ()=>{ return "alt"; } );
					shift = replaceVariables( this.templates.icon, [ [ "icon", "alt" ] ] );
					break;

				case "lock":
					this._LockAction( key_id );
					shift = replaceVariables( this.templates.lock, [ [ "id", key_id + "lock" ] ] );
					break;

				case "backspace":
					this._BackSpaceAction( key_id );
					shift = replaceVariables( this.templates.icon, [ [ "icon", "backspace" ] ] );
					break;

				default:
					this._DefaultAction( key_id, _col );
			}
			var keyValue = parseInt( _col[ 0 ] );
			var disable = this.config.digit &amp;&amp; _col[ 5 ] != "backspace" &amp;&amp; ( !( keyValue >= 0 &amp;&amp; keyValue &lt;= 9 ) || _col[ 1 ] ) ? " disable" : "";
			var template = ( !_col[ 4 ] || ( !_col[ 1 ] &amp;&amp; !_col[ 2 ] ) ) ? this.templates.single_key : this.templates.key;
			content += replaceVariables( template, [ [ "key_id", key_id ], [ "id", id ], [ "enabled", _col[ 4 ] ? "" : " disabled" ], [ "system", _col[ 5 ] ? " system" : "" ], [ "grow", _col[ 3 ] * 100 ], [ "shift", shift ], [ "std", _col[ 1 ] ], [ "alt", _col[ 2 ] ], [ "disable", disable ] ] );
		} );
		return replaceVariables( this.templates.row, [ [ "content", content ] ] );
	}
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sun Aug 29 2021 11:06:38 GMT+0200 (heure d’été d’Europe centrale) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
